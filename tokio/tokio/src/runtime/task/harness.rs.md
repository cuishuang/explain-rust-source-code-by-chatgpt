# File: tokio/tokio/src/runtime/task/harness.rs

tokio/tokio/src/runtime/task/harness.rs 文件是 Tokio 框架中用于测试异步任务的测试工具。该文件定义了一个名为 `Harness` 的结构体，以及几个相关的辅助结构体和枚举。

`Harness` 结构体是测试工具的核心，用于通过调用异步任务的方法来模拟异步任务的执行。它具有以下主要方法：

- `park` 方法用于将当前任务挂起，直到有新的事件可以处理。这是模拟异步任务等待事件到达的行为。
- `resume` 方法用于命令任务继续执行。这是模拟异步任务被唤醒并继续处理事件的行为。
- `run_to_completion` 方法用于连续运行任务，直到它完成或阻塞。这是模拟异步任务执行完毕的行为。
- `yield_once` 方法用于模拟任务执行过程中主动让出当前执行权，以允许其他任务执行。

除了 `Harness` 结构体外，还有两个辅助结构体 `T` 和 `Guard<'a,T>`。

- `T` 结构体用于将输入数据包装在 `Arc<Mutex<T>>` 中，以支持多线程共享访问。它还提供了一些操作方法，如获取或修改内部数据。
- `Guard<'a, T>` 结构体是 `T` 结构体的包装器，用于在测试中传递 `T` 的权限。

此外，还有几个与异步任务状态相关的枚举类型：

- `PollFuture` 枚举用于表示异步任务的不同状态。它包含 `Ready` 表示任务已经完成，并返回结果，`NotReady` 表示任务仍然在进行中，以及 `Err` 表示任务执行失败。
- `ReadyErr` 枚举是 `Er` 枚举的变体，用于在任务执行过程中返回错误的结果。
- `TestResult` 枚举用于表示测试结果。它包含 `Ok` 表示测试成功，以及 `Err` 表示测试失败并提供相应的错误信息。

以上是 `Harness<T>` 结构体以及相关辅助结构体和枚举的作用和功能的详细介绍。

