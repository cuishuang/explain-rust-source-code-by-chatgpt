# File: vector/src/sinks/s3_common/sink.rs

在Rust生态中，`vector`项目是一个数据处理引擎，用于收集、转换和路由日志和事件数据。`vector`项目的`vector/src/sinks/s3_common/sink.rs`文件是用于实现将数据写入Amazon S3存储服务的功能。

该文件中定义了一个名为`S3Object`的枚举类型，它表示要通过S3服务器上传的对象。该枚举有两个变体：
- `Bytes`: 包含待上传的字节数组，表示将字节数组写入S3对象。
- `Reader`: 包含一个实现了`std::io::Read`特质的对象，表示从该对象读取数据并写入S3对象。

在该文件中还定义了一个名为`S3Sink<Svc, M>`的结构体，它是实现S3数据写入功能的关键组件。这个结构体是一个泛型结构体，有两个类型参数：
- `Svc`：表示S3客户端的服务类型，用于与S3服务器通信。这个类型是一个实现了`aws_sdk_s3::Sdk`特质的对象。
- `M`：表示记录器的数据输出器的类型，用于将日志和事件数据输出到S3。这个类型是一个实现了`Sink`特质的对象。

`S3Sink`结构体实现了`Sink`特质，并定义了一系列相关方法来处理数据的写入操作。具体来说，`S3Sink`结构体具有以下功能和作用：
- 初始化：通过构造函数创建一个新的`S3Sink`实例，并传入S3客户端服务对象和记录器的数据输出器对象。
- 启动：通过`start`方法启动`S3Sink`，准备接收数据并将其写入S3。
- 写入：通过`emit_records`方法将数据写入S3对象。这个方法接收一个`u16`类型的参数，表示从记录器输出器中一次性获取的最大记录数。该方法会从记录器输出器中获取数据，并将其转换为待上传的S3对象，并通过S3客户端服务对象上传到S3服务器。
- 输出剩余数据：通过`shutdown`方法将记录器输出器中剩余的数据写入S3对象。该方法会在停止写入操作前，将尚未写入S3的数据进行清空并写入。
- 停止：通过`stop`方法停止数据的写入操作。

总结一下，`vector/src/sinks/s3_common/sink.rs`文件中的`S3Sink`结构体和相关类型定义了将数据写入Amazon S3存储服务的功能，并暴露了一系列方法用于配置和控制写入操作的行为。

